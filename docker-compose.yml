services:
  emulador:
    image: nginx:alpine
    container_name: emulador
    ports:
      - "4500:80"
    volumes:
      - /mnt/Expansion/roms:/usr/share/nginx/html/roms:rw  # read-write para subidas
      - /home/kroryan/docker-data/roms-server/thumbnails:/usr/share/nginx/html/thumbnails:rw  # read-write para thumbs
      - /home/kroryan/docker-data/roms-server/nginx.conf:/etc/nginx/conf.d/default.conf:ro
      - /home/kroryan/docker-data/roms-server/index.html:/usr/share/nginx/html/index.html:ro
      - /home/kroryan/docker-data/roms-server/.htpasswd:/etc/nginx/.htpasswd:ro
      - /tmp/nginx:/var/cache/nginx  # Temporal de nginx
    command: >
      sh -c "
      mkdir -p /var/cache/nginx/client_temp /var/cache/nginx/proxy_temp /var/cache/nginx/fastcgi_temp /var/cache/nginx/uwsgi_temp /var/cache/nginx/scgi_temp &&
      chmod -R 777 /var/cache/nginx &&
      nginx -g 'daemon off;'
      "
    restart: unless-stopped

  upload-server:
    image: python:3-alpine
    container_name: upload-server
    ports:
      - "8888:8080"
    volumes:
      - /mnt/Expansion/roms:/roms:rw
      - /home/kroryan/docker-data/roms-server/thumbnails:/thumbnails:rw
      - /home/kroryan/docker-data/roms-server/upload_server.py:/app/upload_server.py:ro
    working_dir: /app
    command: ["python3", "upload_server.py"]
    restart: unless-stopped
