server {
    listen 80;
    server_name localhost;

    # Autenticacion basica
    auth_basic "Zona Privada - Mis ROMs";
    auth_basic_user_file /etc/nginx/.htpasswd;

    # Main page
    location = / {
        root /usr/share/nginx/html;
        index index.html;

        # CORS
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, PUT, DELETE, MKCOL, COPY, MOVE' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length, Content-Range' always;
    }

    location = /index.html {
        root /usr/share/nginx/html;

        # CORS
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
    }

    # ROMs folder con WebDAV para subidas
    location /roms/ {
        alias /usr/share/nginx/html/roms/;
        autoindex on;
        autoindex_exact_size off;

        # CORS
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, PUT, DELETE, MKCOL, COPY, MOVE' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length, Content-Range' always;

        # WebDAV
        dav_methods PUT DELETE MKCOL COPY MOVE;
        dav_access user:rw group:r all:r;

        # Max upload size (50MB por ROM)
        client_max_body_size 50M;
        client_body_buffer_size 128k;

        # Temporales
        create_full_put_path on;
    }

    # Thumbnails con WebDAV para guardar
    location /thumbnails/ {
        alias /usr/share/nginx/html/thumbnails/;
        try_files $uri =404;

        # CORS
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, PUT, DELETE' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length, Content-Range' always;

        # WebDAV
        dav_methods PUT DELETE;
        dav_access user:rw group:r all:r;

        # Max upload size (5MB para thumbnail)
        client_max_body_size 5M;
    }
}
